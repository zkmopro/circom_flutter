# Mopro Flutter Package

A Flutter plugin for generating and verifying zero-knowledge proofs (ZKPs) on mobile platforms (iOS/Android). This package provides a simple interface to interact with proof systems such as Circom and Halo2, supporting multiple proof libraries (e.g., Arkworks, Rapidsnark).

## Getting Started

Follow these steps to integrate the Mopro Flutter package into your project.

### Adding a package dependency to an app

1.  **Add Dependency:** You can add `mopro_flutter_bindings` to your project by manually editing `pubspec.yaml`.

    -   **Manual Edit (Required for local path or specific Git dependencies):**
        Open your `pubspec.yaml` file and add `mopro_flutter_bindings` under `dependencies`.

        ```yaml
        dependencies:
            flutter:
                sdk: flutter

            mopro_flutter_bindings:
                git:
                    url: https://github.com/zkmopro/mopro_flutter_package
            # Or
            # mopro_flutter_package:
            #    path: ../mopro_flutter_package
        ```

2.  **Update Circuit Asset:** Include your compiled Circom `.zkey` file as an asset. Add the asset path to your `pubspec.yaml` under the `flutter:` section:

    ```yaml
    flutter:
        uses-material-design: true # Ensure this is present
        assets:
            # Add the directory containing your .zkey file(s)
            - assets/...zkey
            # Or specify the file directly:
            # - assets/multiplier2_final.zkey
    ```

    _Make sure the path points correctly to where you've placed your `.zkey` file within your Flutter project._

3.  **Install Package:** Run the following command in your terminal from the root of your Flutter project:

    ```bash
    flutter pub get
    ```

## Usage Example

Here's a basic example demonstrating how to use the package to generate and verify a proof for a simple [multiplier circuit](https://github.com/zkmopro/circuit-registry/blob/main/multiplier2/multiplier2.circom).

Update the main function to initialize the Rust library before running the app:

```dart
void main() async {
  await RustLib.init();
  runApp(const MyApp());
}
```

Import the package and use it:

```dart
// Import the package
import 'package:mopro_flutter_bindings/src/rust/third_party/mopro_example_app.dart'; // Change to your library name
import 'package:mopro_flutter_bindings/src/rust/frb_generated.dart';

final zkeyPath = await copyAssetToFileSystem(
    'assets/multiplier2_final.zkey',
)

// Corresponds to the inputs of multiplier2.circom
const int a = 3;
const int b = 5;
final Map<String, List<String>> inputs = {
    'a': [a.toString()],
    'b': [b.toString()],
};
// Convert inputs to JSON string
final String inputsJson = jsonEncode(inputs);

// Use the zkey asset path provided in pubspec.yaml
final CircomProofResult proofResult = await generateCircomProof(
    zkeyPath: zkeyPath,
    circuitInputs: inputsJson,
    proofLib: ProofLib.arkworks,
);

final bool isValid = await verifyCircomProof(
    zkeyPath: zkeyPath,
    proofResult: proofResult,
    proofLib: ProofLib.arkworks,
);

print('Generated Proof: ${proofResult.proof}');
print('Public Inputs/Outputs: ${proofResult.inputs}');
print('Verification result: $isValid');
```

> [!NOTE]
> To learn how to read a `.zkey` file from an app, please refer to the [`copyAssetToFileSystem`](https://github.com/zkmopro/flutter-app/blob/a36ef9a78b35ea2618dafd4224c4f60e014e2e10/lib/main.dart#L584) function in the Flutter app.

> [!WARNING]  
> The default bindings are built specifically for the `multiplier2` circom circuit. If you'd like to update the circuit or switch to a different proving scheme, please refer to the [How to Build the Package](#how-to-build-the-package) section.<br/>
> Circuit source code: https://github.com/zkmopro/circuit-registry/tree/main/multiplier2<br/>
> Example .zkey file for the circuit: http://ci-keys.zkmopro.org/multiplier2_final.zkey<br/>

## How to Build the Package

### Generate the bindings using the Mopro CLI

This package relies on bindings generated by the Mopro CLI.
To learn how to build Mopro bindings, refer to the [Getting Started](https://zkmopro.org/docs/getting-started) section.
If you'd like to generate custom bindings for your own circuits or proving schemes, check out the guide on how to use the Mopro CLI: [Rust Setup for Android/iOS Bindings](https://zkmopro.org/docs/setup/rust-setup#setup-any-rust-project).

Choose **Flutter** to build the bindings, or run

```sh
mopro build --platforms flutter
```

to generate the flutter package.

Then, replace the entire bindings directory `mopro_flutter_package` with your generated files in the current folder:

```t
├── android
├── cargokit
├── flutter_rust_bridge.yaml
├── ios
├── lib
├── pubspec.yaml
└── rust
```

or running e.g.

```sh
cp -R \
  mopro_flutter_bindings/android \
  mopro_flutter_bindings/cargokit \
  mopro_flutter_bindings/flutter_rust_bridge.yaml \
  mopro_flutter_bindings/ios \
  mopro_flutter_bindings/lib \
  mopro_flutter_bindings/pubspec.yaml \
  mopro_flutter_bindings/rust \
  mopro_flutter_package/
```

### Flutter Example App

-   Open the example app that uses the defined flutter package in the [`example/`](example) folder
    ```sh
    cd example
    ```
-   Install the dependencies
    ```sh
    flutter pub get
    ```
-   Open an iOS simulator/device or an Android emulator/device and run the example app
    ```sh
    flutter run
    ```
-   Clean the cache if you update the bindings and it throws errors
    ```sh
    flutter clean
    ```

> ![WARNING]
> Bindings generated by the mopro CLI use local crate paths by default, which makes them non-reproducible on other devices.
> To make the build reproducible, publish your Rust crate and reference it via a Git source instead of a local path at [here](https://github.com/vivianjeng/mopro_flutter_package/blob/983ebcb60103c961c870634d3f3df54d6d6dc564/rust/Cargo.toml#L7).
> If you’d like to help address this limitation, contributions are welcome — see https://github.com/zkmopro/mopro/issues/647
> .

## Community

-   X account: <a href="https://twitter.com/zkmopro"><img src="https://img.shields.io/twitter/follow/zkmopro?style=flat-square&logo=x&label=zkmopro"></a>
-   Telegram group: <a href="https://t.me/zkmopro"><img src="https://img.shields.io/badge/telegram-@zkmopro-blue.svg?style=flat-square&logo=telegram"></a>

## Acknowledgements

This work was initially sponsored by a joint grant from [PSE](https://pse.dev/) and [0xPARC](https://0xparc.org/). It is currently incubated by PSE.
